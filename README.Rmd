---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# jlme

<!-- badges: start -->
[![R-CMD-check](https://github.com/yjunechoe/jlme/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/yjunechoe/jlme/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

Julia (mixed-effects) regression modelling from R

## Installation

You can install the development version of jlme from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("yjunechoe/jlme")
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r example}
library(jlme)
jlme_setup()
```

## Use `{jlme}`

### Fixed effects models

```{r}
lm(mpg ~ hp, mtcars)
jlm(mpg ~ hp, mtcars)

x <- mtcars
x$am_sum <- factor(x$am)
contrasts(x$am_sum) <- contr.sum(2)
lm(mpg ~ am_sum, x)
jlm(mpg ~ am_sum, x)

x$cyl_helm <- factor(x$cyl)
contrasts(x$cyl_helm) <- contr.helmert(3)
colnames(contrasts(x$cyl_helm)) <- c("4vs6", "4&6vs8")
lm(mpg ~ cyl_helm, x)
jlm(mpg ~ cyl_helm, x)
```

### Mixed effects models

```{r}
library(lme4)

lmer(Reaction ~ Days + (Days | Subject), sleepstudy)
jlmer(Reaction ~ Days + (Days | Subject), sleepstudy)
jlmer(Reaction ~ Days + (Days | Subject), sleepstudy, REML = TRUE)

glmer(r2 ~ Anger + Gender + (1 | id), VerbAgg, family = "binomial")
jlmer(r2 ~ Anger + Gender + (1 | id), VerbAgg, family = "binomial")
```

### Inspect model objects

```{r}
jmod <- jlmer(Reaction ~ Days + (Days | Subject), sleepstudy)

tidy(jmod)
glance(jmod)
```

## With `{JuliaConnectoR}`

### Inspect model objects with Julia code

```{r}
library(JuliaConnectoR)
juliaCall("propertynames", jmod)
juliaLet("x.rePCA", x = jmod)
```

### Create bindings to Julia libs to access more features

```{r}
MixedModels <- juliaImport("MixedModels")

# Long-form construction of the `jmod` sleepstudy model
jmod <- MixedModels$fit(
  MixedModels$LinearMixedModel,
  juliaEval("@formula(Reaction ~ Days + (Days | Subject))"),
  juliaPut(sleepstudy)
)
MixedModels$issingular(jmod)

# Same as above in complete Julia syntax, using the julia `sleepstudy` dataset
juliaEval("
  fit(
    LinearMixedModel,
    @formula(reaction ~ days + (days | subj)),
    MixedModels.dataset(:sleepstudy)
  )
")

# Use other features from MixedModels.jl
Random <- juliaImport("Random") # juliaEval('Pkg.add("Random")')
samp <- MixedModels$parametricbootstrap(
  Random$MersenneTwister(42L), # RNG
  1000L, # Number of simulations
  jmod # Model
)
samp
```

```{r, echo = FALSE}
stop_julia()
```

